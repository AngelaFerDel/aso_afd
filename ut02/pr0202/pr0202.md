#### [Volver a Unidad 2](../index.md)

------------

# Unidad 2 - Práctica 2: Conexión SSH

#### 1. Preparación de la máquina y configuración de la red

1.

Desde la interfaz de VirtualBox añadimos un adaptador en modo solo anfitrión para poder conectarnos desde nuestra máquina física.

![Captura apartado 1](pr0202_Capturas/pr0202_1.png)

2.

Encendemos la máquina y comprobamos la IP que tenemos usando el comando `ip a`.
Como no nos da IP, deberemos acceder al archivo de configuración de las interfaces de red para ver que está activado el dhcp.
Accedemos haciendo `sudo nano /etc/netplan/50-cloud-init.yaml`
Deberemos añadir el segundo adaptador de la siguiente manera:

![Captura apartado 2](pr0202_Capturas/pr0202_2.png)

Ahora aplicamos los cambios: `sudo netplan apply`
Ahora por último comprobaremos de nuevo que ip nos da usanod el comando `ip a`

![Captura apartado 3](pr0202_Capturas/pr0202_3.png)

3.

Para probar la conectividad entre máquina virtual y máquina anfitriona, haremos un `ping` desde nuestra máquina virtual a nuestra anfitriona o viceversa.
Si el resultado del ping no es error, las máquinas están conectadas entre sí.

![Captura apartado 4](pr0202_Capturas/pr0202_4.png)

4.

Para cambiar el nombre del host cambiaremos el nombre desde un archivo de configuración, haremos:

`sudo nano /etc/hostname`

Aquí cambiaremos el nombre que teniamos que era "asoserver" y lo cambiaremos por "afd_server"

![Captura apartado 5](pr0202_Capturas/pr0202_5.png)

Para comprobarlo, podemos ejecutar el comando `sudo hostnamectl`. Esto nos dará una serie de datos siento el primero el 'hostname'. Verificamos que ahí pone afd_server.

![Captura apartado 6](pr0202_Capturas/pr0202_6.png)

Para comprobar si lo he hemos hecho bien, podemos usar el comando `hostname`. Si vemos que nuestro nombre de host no ha cambiado, deberemos usar el comando `sudo hostnamectl set-hostname afd_server` para cambiar el nombre de host.

5.

Para resolver localmente el nombre del servidor deberemos ir al archivo de configuración en C:\Windows\System32\Drivers\etc\hosts
Ahí, al final del documento escribiremos la ip de nuestra máquina virtual con el nombre de host.

![Captura apartado 7](pr0202_Capturas/pr0202_7.png)

Ahora si intentamos conectarnos por ssh pero en vez de poner la ip ponemos el nombre de host, funcionará como si hubiesemos escrito la ip

![Captura apartado 8](pr0202_Capturas/pr0202_8.png)



#### 2. Creación del usuario y conexión SS

Desde Windows, usamos el comando ssg-keys, eso nos genera 2 claves, una publica y otra privada, que nos las genera en C:\users\alumnoª.ssh
Se llaman algo como id_ed25519 y id_ed25519.pub. El que es .pub corresponde a la clave publica, esa es la que deberemos enviar a la máquina virtual.
Para enviar la clave usamos scp, que funciona parecido al comando cp:
`spc .\id_ed25519.pub angela@<ipmaquina>:~`

Si ahora accedemos a nuestra máquina virtual y hacemos un ls en el directorio personal, veremos que ahí está la clave pública.
Si hacemos un `ls -a` veremos que tenemos una carpeta llamada .ssh
Hay que añadir el contenido de la clave publica a authorized_keys, para ello usamos 

`cat id_ed25519.pub > authorized_keys`

(Usaremos el redireccionamiento ">>" si el fichero de authorized kays no estuviese vacío y así añadiríamos el contenido)

Un buen habito ahora es desactivar el inicio de sesión sin contraseña
Eso se hace desde `sudo nano /etc/ssh/sshd_config`
Deberemos buscar en el archivo una opción que etsá comentada que es PasswordAunthentication, la desconectaremos y luego añadiremos "no".
De esta manera cada vez que accedamos no nos pedirá contraseña porque revisará las claves público y privada.

------------

#### [Volver a Unidad 2](../index.md)