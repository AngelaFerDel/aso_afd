#### [Volver a Unidad 2](../index.md)

------------

# Unidad 2 - Pr치ctica 2: Conexi칩n SSH

## Ejercicio 1 - Preparaci칩n de la m치quina y configuraci칩n de la red

### Apartado 1.

Desde la interfaz de VirtualBox a침adimos un adaptador en modo solo anfitri칩n para poder conectarnos desde nuestra m치quina f칤sica.

![Captura apartado 1](pr0202_Capturas/pr0202_1.png)

### Apartado 2.

Encendemos la m치quina y comprobamos la IP que tenemos usando el comando `ip a`.
Como no nos da IP, deberemos acceder al archivo de configuraci칩n de las interfaces de red para ver que est치 activado el dhcp.
Accedemos haciendo `sudo nano /etc/netplan/50-cloud-init.yaml`
Deberemos a침adir el segundo adaptador de la siguiente manera:

![Captura apartado 2](pr0202_Capturas/pr0202_2.png)

Ahora aplicamos los cambios: `sudo netplan apply`
Ahora por 칰ltimo comprobaremos de nuevo que ip nos da usanod el comando `ip a`

![Captura apartado 3](pr0202_Capturas/pr0202_3.png)

### Apartado 3.

Para probar la conectividad entre m치quina virtual y m치quina anfitriona, haremos un `ping` desde nuestra m치quina virtual a nuestra anfitriona o viceversa.
Si el resultado del ping no es error, las m치quinas est치n conectadas entre s칤.

![Captura apartado 4](pr0202_Capturas/pr0202_4.png)

### Apartado 4.

Para cambiar el nombre del host cambiaremos el nombre desde un archivo de configuraci칩n, haremos:

`sudo nano /etc/hostname`

Aqu칤 cambiaremos el nombre que teniamos que era "asoserver" y lo cambiaremos por "afd_server"

![Captura apartado 5](pr0202_Capturas/pr0202_5.png)

Para comprobarlo, podemos ejecutar el comando `sudo hostnamectl`. Esto nos dar치 una serie de datos siento el primero el 'hostname'. Verificamos que ah칤 pone afd_server.

![Captura apartado 6](pr0202_Capturas/pr0202_6.png)

Para comprobar si lo he hemos hecho bien, podemos usar el comando `hostname`. Si vemos que nuestro nombre de host no ha cambiado, deberemos usar el comando `sudo hostnamectl set-hostname afd_server` para cambiar el nombre de host.

### Apartado 5.

Para resolver localmente el nombre del servidor deberemos ir al archivo de configuraci칩n en C:\Windows\System32\Drivers\etc\hosts
Ah칤, al final del documento escribiremos la ip de nuestra m치quina virtual con el nombre de host.

![Captura apartado 7](pr0202_Capturas/pr0202_7.png)

Ahora si intentamos conectarnos por ssh pero en vez de poner la ip ponemos el nombre de host, funcionar치 como si hubiesemos escrito la ip

![Captura apartado 8](pr0202_Capturas/pr0202_8.png)



## Ejercicio 2 - Creaci칩n del usuario y conexi칩n SS

### Apartado 1. 

Desde nuestra m치quina Ubuntu Server crearemos el usuario afd_ssh, para ello emplearmeos el comando `adduser`

![Captura apartado 9](pr0202_Capturas/pr0202_9.png)

### Apartado 2.

Comprobamos que podemos conectarnos por ssh a ese usuario desde PowerShell escribiendo `ssh sfd_ssh@<ip\nombrehost>`:

![Captura apartado 10](pr0202_Capturas/pr0202_10.png)

En este caso nos podemos conectar correctamente.
Si no pudiesemos ser칤a coveniente comprobar el estado del servicio ssh, y activarlo por si se diese el casso de que no est치 activado. Para ello se usan los siguientes comandos:

`sudo systemctl status ssh`

`sudo systemctl enable ssh`


### Apartado 3.

Desde Windows, usamos el comando `ssh-keygen` desde PowerShell, eso nos genera 2 claves, una publica y otra privada, que nos las genera en C:\users\alumno.ssh siendo alumno el nombre del usuario con el que estemos iniciados sesi칩n.
Saldr치n dos claves con un nombre similar a `id_ed25519` y `id_ed25519.pub`. 
El que tiene extensi칩n .pub corresponde a la clave publica, esa es la que deberemos enviar a nuestra m치quina virtual.
Para enviar la clave usamos scp, que funciona parecido al comando cp, lo ejecutaremos desde nuestro PowerShell:
`scp .\id_ed25519.pub angela@<ipmaquina>:~`

Si ahora accedemos a nuestra m치quina virtual y hacemos un ls en el directorio personal, veremos que ah칤 est치 la clave p칰blica.


![Captura apartado 11](pr0202_Capturas/pr0202_11.png)


Si hacemos un `ls -a` veremos que tenemos una carpeta llamada .ssh

![Captura apartado 12](pr0202_Capturas/pr0202_12.png)

Hay que a침adir el contenido de la clave publica a authorized_keys, para ello usamos 

`cat id_ed25519.pub > .ssh\authorized_keys`

(Usaremos el redireccionamiento ">>" si el fichero de authorized_keys no estuviese vac칤o y as칤 a침adir칤amos el contenido)

>游눠 Un buen habito ahora es desactivar el inicio de sesi칩n sin contrase침a
Eso se hace desde `sudo nano /etc/ssh/sshd_config`
Deberemos buscar en el archivo una opci칩n que ets치 comentada que es PasswordAunthentication, la desconectaremos y luego a침adiremos "no".
De esta manera cada vez que accedamos no nos pedir치 contrase침a porque revisar치 las claves p칰blico y privada.

## Ejercicio 3 - Conexi칩n transparente a Github.

Desde el navegador de nuestro ordenador, accedemos a GitHub.
En Configuraci칩n de nuestro perfil, si nos fijamos en el men칰 lateral izquierdo existe la opci칩n SSH and GPG keys.

![Captura apartado 13](pr0202_Capturas/pr0202_13.png)

Desde aqu칤 podremos a침adir nuestra clave p칰blica que hayamos generado con SSH o con GPG. en este caso como tenemos la de ssh, le daremos a New SSH Key.

![Captura apartado 14](pr0202_Capturas/pr0202_14.png)

Aqu칤 podremos ponerle un t칤tulo para identificar mejor de donde es esta clave, seleccionar el tipo de clave, y escribimos nuestra clave p칰blica donde hay un cuadro de texto grande.
Una vez lo hemos puesto aparecer치 algo parecido a esto:

![Captura apartado 15](pr0202_Capturas/pr0202_15.png)

------------

#### [Volver a Unidad 2](../index.md)