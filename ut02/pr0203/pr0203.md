#### [Volver a Unidad 2](../index.md)

------------

# Unidad 2 - Pr치ctica 3: Conexi칩n SSH de varios usuarios

## Preparaci칩n del entorno.

Ser치 necesario 3 m치quinas virtuales:
- Servidor A
- Servidor B
- Servidor C

Necesitaremos una red solo-anfitri칩n que se conectar치 a SERVER-A.

Tambi칠n necesitar치s dos redes internas: 10.20.0.0/16 y 10.30.0.0/16.

Las m치quinas SERVER-A y SERVER-B estar치n conectadas a la primera red, mientras que SERVER-B (que tendr치 2 adaptadores de red) y SERVER-C estar치n conectadas a la segunda red.

El equipo SERVER-A tendr치 un usuario con mi nombre (angela)

Los equipos SERVER-B y SERVER-C tendr치n un usuario llamado sysadmin

## Configuraci칩n de m치quinas virtuales.

Las m치quinas de los 3 servidores ser치n **Ubuntu Server 25.04**. 

Durante la instalaci칩n deberemos marcar la instalaci칩n del servidor **Open-SSH**.

Los nombres de usuario y hostnmame ser치n los indicados por el ejercicio:

- Server-A: angela
- Server-B: sysadmin
- Server-C: sysadmin

En la m치quina virtual de Server-A pondremos 4 adaptadores de red: 1 adaptador en NAT y 3 en Host-Only (Solo-Anfitri칩n).

![Captura 1](pr0203_Capturas/pr0203_1.png)

En las m치quinas virtuales de Server-B yt Server-C tendr치n 2 adaptadores de red cada una: 1 adaptador de red en modo NAT y 1 adaptador de red en modo Host-Only (Solo-Anfitrion).

![Captura 2](pr0203_Capturas/pr0203_2.png)

## Configuraci칩n de red.

### Server-A.

Como tenemos un adaptador en NAT, , si empleamos el comando `ip a` podremos ver que este es el 칰nico adaptador de red que tiene IP, en este caso tenemos la IP: **10.0.2.15**.
Nos apuntaremos el nombre del resto de adaptadores de red, el resto de adaptadores de red tienen los nombres:

- enp0s8.
- enp0s9.
- enp0s10.

Para que el resto de adaptadores de red tengan IP deberemos editar el archivo de configuraci칩n: `sudo nano /etc/netplan/50-cloud-init.yaml`.

En este archivo deberemos a침adir unas l칤neas en la configuraci칩n referentes a cada adaptador de red.

>游눠 Es importante tener en cuenta que cada tabulaci칩n corresponde a dos espacios escritos.

Deber치 quedar el archivo de configuraci칩n de la siguiente manera:

![Captura 3](pr0203_Capturas/pr0203_3.png)

Para aplicar los cambios escribiremos el comando `sudo netplan apply`.

Comprobaremos las IPs usando el comando `ip a`. Las IPs deber칤an quedar as칤:

![Captura 4](pr0203_Capturas/pr0203_4.png)

Podemos comprobar que los adaptadores tienen las IPs:
- 192.168.56.10/24
- 10.20.0.10/16
- 10.30.0.10/16

Para comprobar que funciona nos conectaremos por SSH a la IP 192.168.56.10/24

![Captura 5](pr0203_Capturas/pr0203_5.png)

Veremos que se ha conectado con 칠xito.

### Server-B y Server-C.

Primero deberemos comprobar el nombre de los adaptadores usando el comando `ip a`.
Configuraremos el archivo: `sudo nano /etc/netplan/50-cloud-init.yaml` para darles IPs a los adaptadores de red quee st치n en modo Host-Only.

- Resultado del archivo de configuraci칩n en el Server-B:

![Captura 6](pr0203_Capturas/pr0203_6.png)

![Captura 7](pr0203_Capturas/pr0203_7.png)

- Resultado del archivo de configuraci칩n en el Server-C:

![Captura 8](pr0203_Capturas/pr0203_8.png)

![Captura 9](pr0203_Capturas/pr0203_9.png)

### Prueba de conectividad.

Ahora con toda la red configurada deberemos comprobar las siguientes conexiones:

- Desde Server-B haremos `ping` a 10.20.0.10 (adaptador de Server-A)

![Captura 10](pr0203_Capturas/pr0203_10.png)

- Desde Server-C: haremos `ping`a 10.30.0.10 (adaptador de Server-A)

![Captura 11](pr0203_Capturas/pr0203_11.png)

- Conectarnos por SSH a el Server-B y el Server-C desde nuestra m치quina anfitriona.
>游눠 Deber칤a dar error.

![Captura 12](pr0203_Capturas/pr0203_12.png)

**Si todo esto funciona correctamente, tenemos la red bien configurada.**

## Configuraci칩n de claves SSH.

Generaremos claves SSH para poder acceder a las maquinas sin una contrase침a.

1. Generamos las claves desde la m치quina anfitriona usando el comando `ssh-keygen`. Esto generar치 un par de claves, una p칰blica y otra privada. La p칰blica termina con la extensi칩n .pub

![Captura 13](pr0203_Capturas/pr0203_13.png)

2. Usando el comando `scp` copiaremos la clave p칰blica a nuestro Server-A de la siguiente manera:

![Captura 14](pr0203_Capturas/pr0203_14.png)

3. Nos conectamos por ssh a nuestro Server-A. Desde ah칤, moveremos el archivo de la clave p칰blica que hemos puesto en el directorio personal para a침adirlo al documento **.ssh/authorized_keys**

![Captura 15](pr0203_Capturas/pr0203_15.png)

>游눠 Si ahora comprobamos a salir y volver a acceder mediante ssh, ahora no nos pedir치 la contrase침a.

![Captura 16](pr0203_Capturas/pr0203_16.png)

4. Desde el Server-A, generamos otro par de claves usando el comando `ssh-keygen -b 1024`

![Captura 17](pr0203_Capturas/pr0203_17.png)

5. Esto genera un par de claves, una p칰blica y privada, deberemos copiar la clave p칰blica a el Server-B y al Server-C. para ello usaremos de nuevo el comando `scp`.

![Captura 18](pr0203_Capturas/pr0203_18.png)

6. Entraremos ahora por ssh al Server-B, a침adiremos el contenido de la clave al fichero `.ssh/authorized_keys`

![Captura 19](pr0203_Capturas/pr0203_19.png)

>游눠 Si ahora comprobamos a salir y volver a acceder mediante ssh, ahora no nos pedir치 la contrase침a.

![Captura 20](pr0203_Capturas/pr0203_20.png)

8. Ahora repetiremos el proceso desde el Server-C, primero accedemos desde ssh y copiamos el contenido de la clave p칰blica en el fichero `.ssh/authorized_keys`.

> Aunque en la captura el nombre sea server-b, se trata del server-c, para agilizar el proceso de creaci칩n de m치quinas clon칠 la m치quina server-b para no tener que hacer dos y olvid칠 cambiar el hostname.

![Captura 21](pr0203_Capturas/pr0203_21.png)

>游눠 Si ahora comprobamos a salir y volver a acceder mediante ssh, ahora no nos pedir치 la contrase침a.

![Captura 22](pr0203_Capturas/pr0203_22.png)



------------

#### [Volver a Unidad 2](../index.md)