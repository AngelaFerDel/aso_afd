#### [Volver a Unidad 6](../index.md)

------------

# Unidad 6 - Práctica 5: Limpieza de logs.

Para este ejercicio se pide la realización de un script que almacene la información de los logs en formato CSV siguiendo un formato determinado.

Los datos de entrada de los logs son los siguientes:

## Datos de entrada

```
$logCrudo = @"
[INFO] ID:8842 :: 2023/11/01_10:00 :: User:admin_01 :: Action:Login_Success
[ERROR] ID:9921 :: 2023/11/01_10:05 :: User:guest_user :: Action:Auth_Fail (Pass)
[WARN] ID:8843 :: 2023-11-01 10:15 :: User:dev_team :: Action:Upload_Limit_Exceeded
[CRITICAL] ID:1001 :: 01-11-2023_10:20 :: User:ROOT :: Action:Service_Stop
"@
```

## Script que pide el ejercicio

```
$logCrudo = @"
[INFO] ID:8842 :: 2023/11/01_10:00 :: User:admin_01 :: Action:Login_Success
[ERROR] ID:9921 :: 2023/11/01_10:05 :: User:guest_user :: Action:Auth_Fail (Pass)
[WARN] ID:8843 :: 2023-11-01 10:15 :: User:dev_team :: Action:Upload_Limit_Exceeded
[CRITICAL] ID:1001 :: 01-11-2023_10:20 :: User:ROOT :: Action:Service_Stop
"@

$lineas = $logCrudo -split "`n"
$resultado = @()

foreach ($linea in $lineas) {

    if ($linea -like "[INFO]*") {
        continue
    }

    $severity = ($linea -split "\]")[0] -replace "\[", ""

    $eventID = ($linea -split "ID:")[1] -split "::"

    $eventID = $eventID[0].Trim()

    $fechaTexto = ($linea -split "::")[1].Trim()

    $fechaTexto = $fechaTexto -replace "_", " "

    $fechaTexto = $fechaTexto -replace "/", "-"

    $timestamp = Get-Date $fechaTexto -Format "yyyy-MM-dd HH:mm"

    $user = ($linea -split "User:")[1] -split "::"
    $user = $user[0].Trim().ToLower()

    if ($user -eq "root") {
        $user = "administrator"
    }

    $action = ($linea -split "Action:")[1].Trim()

    $objeto = [PSCustomObject]@{
        TimeStamp = $timestamp
        Severity  = $severity
        User      = $user
        EventID   = $eventID
        Action    = $action
    }

    $resultado += $objeto
}

$resultado | Export-Csv "reporte_seguridad.csv" -NoTypeInformation -Encoding UTF8
```

Con este script se obtiende un csv con la estructura de tabla siguiente:
```
TimeStamp             |	Severity    |	User    |	EventID	    |   Action
2023-11-01 10:05	     ERROR	      guest_user	  9921	      Auth_Fail (Pass)
2023-11-01 10:15	     WARN	       dev_team	      8843	      Upload_Limit_Exceeded
2023-11-01 10:20	    CRITICAL	 administrator	  1001	      Service_Stop
```

------------

#### [Volver a Unidad 6](../index.md)
